{% load static %}
<!DOCTYPE html>
<html lang="en">

<head>
	<title>Rainfall</title>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="description" content="Travello template project">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	{% include 'css-link/css.html' %}
</head>

<body>

	<div class="super_container">

		<!-- Header -->

		{% include 'header.html' %}

		<!-- Menu -->

		{% include 'menu.html' %}

		<!-- Home -->
		{% include 'home.html' %}

		{% block content %}

		{% endblock content %}


		<!-- Footer -->
		{% include 'footer.html' %}

	</div>
	{% include 'js-link/js.html' %}
	<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
	<script>
		let myChart = "";
		let stateFirst = "";
		let stateSecond = "";
		let count = 0;

		function check(num, stateIndex) {
			let arr = {
				{
					data.stateList | safe
				}
			}
			if (num == 1) {
				stateFirst = arr[stateIndex];
			} else if (num == 2) {
				stateSecond = arr[stateIndex];
			}
			console.log("state Name is :-", arr[stateIndex]);
		}

		function fetchData() {
			if (count == 0) {
				count += 1;
				dataset = {
					{
						data.datasets | safe
					}
				};
				const da1 = dataset[stateFirst][0];
				const da2 = dataset[stateSecond][0];
				const year = {
					{
						data.year
					}
				};
				let data = [];
				let data2 = [];
				console.log("data:-", data);
				console.log("data2:-", data2);
				for (let i = 0; i < da1.length; i++) {
					data.push({
						x: year[i],
						y: da1[i]
					});
				}
				for (let i = 0; i < da2.length; i++) {
					data2.push({
						x: year[i],
						y: da2[i]
					});
				}

				const totalDuration = 10000;
				const delayBetweenPoints = totalDuration / data.length;
				const previousY = (ctx) => ctx.index === 0 ? ctx.chart.scales.y.getPixelForValue(100) : ctx.chart
					.getDatasetMeta(ctx.datasetIndex).data[ctx.index - 1].getProps(['y'], true).y;
				const ctx = document.getElementById('myChart').getContext('2d');
				myChart = new Chart(ctx, {
					type: 'line',
					data: {
						datasets: [{
								label: stateFirst,
								borderColor: '#166a8f',
								borderWidth: 1,
								radius: 3,
								data: data,
							},
							{
								label: stateSecond,
								borderColor: '#f67019',
								borderWidth: 1,
								radius: 3,
								data: data2,
							}
						]
					},
					options: {
						animation: {
							x: {
								type: 'number',
								easing: 'linear',
								duration: delayBetweenPoints,
								from: NaN, // the point is initially skipped
								delay(ctx) {
									if (ctx.type !== 'data' || ctx.xStarted) {
										return 0;
									}
									ctx.xStarted = true;
									return ctx.index * delayBetweenPoints;
								}
							},
							y: {
								type: 'number',
								easing: 'linear',
								duration: delayBetweenPoints,
								from: previousY,
								delay(ctx) {
									if (ctx.type !== 'data' || ctx.yStarted) {
										return 0;
									}
									ctx.yStarted = true;
									return ctx.index * delayBetweenPoints;
								}
							}
						},
						responsive: false,
						interaction: {
							intersect: false
						},
						plugins: {
							legend: {
								position: 'top',
							},
							title: {
								display: true,
								text: 'State Comparsion'
							},
						},
						scales: {
							x: {
								type: 'linear'
							}
						}
					}
				});
			} else {
				myChart.destroy();
				dataset = {
					{
						data.datasets | safe
					}
				};
				const da1 = dataset[stateFirst][0];
				const da2 = dataset[stateSecond][0];
				const year = {
					{
						data.year
					}
				};
				let data = [];
				let data2 = [];
				console.log("data:-", data);
				console.log("data2:-", data2);
				for (let i = 0; i < da1.length; i++) {
					data.push({
						x: year[i],
						y: da1[i]
					});
				}
				for (let i = 0; i < da2.length; i++) {
					data2.push({
						x: year[i],
						y: da2[i]
					});
				}
				const totalDuration = 10000;
				const delayBetweenPoints = totalDuration / data.length;
				const previousY = (ctx) => ctx.index === 0 ? ctx.chart.scales.y.getPixelForValue(100) : ctx.chart
					.getDatasetMeta(ctx.datasetIndex).data[ctx.index - 1].getProps(['y'], true).y;
				const ctx = document.getElementById('myChart').getContext('2d');

				myChart = new Chart(ctx, {
					type: 'line',
					data: {
						datasets: [{
								label: stateFirst,
								borderColor: '#166a8f',
								borderWidth: 1,
								radius: 3,
								data: data,
							},
							{
								label: stateSecond,
								borderColor: '#f67019',
								borderWidth: 1,
								radius: 3,
								data: data2,
							}
						]
					},
					options: {
						animation: {
							x: {
								type: 'number',
								easing: 'linear',
								duration: delayBetweenPoints,
								from: NaN, // the point is initially skipped
								delay(ctx) {
									if (ctx.type !== 'data' || ctx.xStarted) {
										return 0;
									}
									ctx.xStarted = true;
									return ctx.index * delayBetweenPoints;
								}
							},
							y: {
								type: 'number',
								easing: 'linear',
								duration: delayBetweenPoints,
								from: previousY,
								delay(ctx) {
									if (ctx.type !== 'data' || ctx.yStarted) {
										return 0;
									}
									ctx.yStarted = true;
									return ctx.index * delayBetweenPoints;
								}
							}
						},
						responsive: false,
						interaction: {
							intersect: false
						},
						plugins: {
							legend: {
								position: 'top',
							},
							title: {
								display: true,
								text: 'State Comparsion'
							}
						},

						scales: {
							x: {
								type: 'linear'
							}
						}
					}
				});



				/*myChart.data.datasets[0].data = data; // Would update the first dataset's value of 'March' to be 50
				myChart.data.datasets[1].data = data2;
				myChart.options.animation = {
				        x: {
				            type: 'number',
				            easing: 'easeOutQuart',
				            duration: delayBetweenPoints,
				            from: NaN, // the point is initially skipped
				            delay(ctx) {
				                if (ctx.type !== 'data' || ctx.xStarted) {
				                    return 0;
				                }
				                ctx.xStarted = true;
				                return ctx.index * delayBetweenPoints;
				            } 
				        },
				        y: {
				            type: 'number',
				            easing: 'easeOutQuart',
				            duration: delayBetweenPoints,
				            from: previousY,
				            delay(ctx) {
				                if (ctx.type !== 'data' || ctx.yStarted) {
				                    return 0;
				                }
				                ctx.yStarted = true;
				                return ctx.index * delayBetweenPoints;
				            }
				        } 
				}
				myChart.update('active'); */
			}



		}
	</script>
</body>

</html>